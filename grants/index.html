<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feed Tulum Grants</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŒ®</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Source+Serif+4:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --terracotta: #C65D3B;
            --terracotta-dark: #A84E32;
            --sand: #F4F1DE;
            --jungle: #2C3E50;
            --cream: #FDFCF7;
            --text-dark: #1a1a1a;
            --text-medium: #4a4a4a;
            --text-light: #666;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            color: var(--text-dark);
            background-color: var(--sand);
            line-height: 1.6;
            min-height: 100vh;
        }

        h1, h2, h3 {
            font-family: 'Source Serif 4', Georgia, serif;
            color: var(--jungle);
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .login-container {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            margin-top: 100px;
        }

        .login-container h1 {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .login-subtitle {
            text-align: center;
            color: var(--text-medium);
            margin-bottom: 2rem;
            font-size: 0.95rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-dark);
        }

        input[type="password"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            font-family: inherit;
        }

        input[type="password"]:focus {
            outline: none;
            border-color: var(--terracotta);
        }

        .btn {
            width: 100%;
            padding: 0.875rem;
            background: var(--terracotta);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn:hover {
            background: var(--terracotta-dark);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .error-message {
            background: #fee;
            color: #c33;
            padding: 0.75rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .dashboard {
            display: none;
        }

        .dashboard.show {
            display: block;
        }

        .dashboard-header {
            background: white;
            padding: 1.5rem 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }

        .dashboard-header h1 {
            font-size: 1.5rem;
        }

        .btn-logout {
            padding: 0.5rem 1rem;
            background: transparent;
            color: var(--text-medium);
            border: 1px solid var(--text-medium);
            border-radius: 4px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            width: auto;
        }

        .btn-logout:hover {
            background: var(--jungle);
            color: white;
            border-color: var(--jungle);
        }

        .dashboard-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }

        .grants-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .grant-card {
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--cream);
        }

        .grant-card:hover {
            border-color: var(--terracotta);
            box-shadow: 0 2px 8px rgba(198, 93, 59, 0.1);
        }

        .grant-card.expanded {
            background: white;
            border-color: var(--terracotta);
        }

        .grant-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .grant-title {
            flex: 1;
            min-width: 200px;
        }

        .grant-title h3 {
            font-size: 1.15rem;
            margin-bottom: 0.25rem;
            color: var(--jungle);
        }

        .grant-funder {
            font-size: 0.9rem;
            color: var(--text-medium);
        }

        .grant-meta {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .grant-amount {
            font-weight: 600;
            color: var(--terracotta);
        }

        .grant-deadline {
            color: var(--text-medium);
            font-size: 0.9rem;
        }

        .priority-stars {
            color: var(--terracotta);
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .status-ready {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status-submitted {
            background: #e3f2fd;
            color: #1565c0;
        }

        .grant-details {
            display: none;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e0e0e0;
        }

        .grant-card.expanded .grant-details {
            display: block;
        }

        .detail-section {
            margin-bottom: 1.5rem;
        }

        .detail-section h4 {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            color: var(--jungle);
        }

        .detail-section p, .detail-section ul {
            color: var(--text-medium);
            font-size: 0.95rem;
        }

        .instructions-list {
            list-style: none;
            padding: 0;
        }

        .instructions-list li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .instructions-list li:before {
            content: "â†’";
            position: absolute;
            left: 0;
            color: var(--terracotta);
        }

        .material-item {
            background: var(--sand);
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
        }

        .material-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .material-label {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.9rem;
        }

        .btn-copy {
            padding: 0.25rem 0.75rem;
            background: var(--terracotta);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-copy:hover {
            background: var(--terracotta-dark);
        }

        .material-content {
            font-family: monospace;
            font-size: 0.85rem;
            color: var(--text-medium);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn-submit {
            padding: 0.5rem 1rem;
            background: var(--jungle);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-submit:hover {
            background: var(--text-dark);
        }

        .hidden {
            display: none;
        }

        /* Kanban Board Styles */
        .kanban-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .kanban-column {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            min-height: 400px;
        }

        .kanban-column h3 {
            font-size: 1rem;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--sand);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        #column-consider h3 {
            color: var(--text-medium);
            border-bottom-color: var(--text-medium);
        }

        #column-progress h3 {
            color: var(--terracotta);
            border-bottom-color: var(--terracotta);
        }

        #column-submitted h3 {
            color: #2e7d32;
            border-bottom-color: #2e7d32;
        }

        .kanban-cards {
            min-height: 300px;
        }

        .kanban-cards .grant-card {
            margin-bottom: 0.75rem;
            cursor: move;
        }

        .kanban-cards .grant-card:last-child {
            margin-bottom: 0;
        }

        .sortable-ghost {
            opacity: 0.4;
        }

        .sortable-drag {
            cursor: grabbing !important;
        }

        @media (max-width: 768px) {
            .grant-header {
                flex-direction: column;
            }

            .grant-meta {
                width: 100%;
                justify-content: space-between;
            }

            .dashboard-header {
                flex-direction: column;
                gap: 1rem;
            }

            .btn-logout {
                width: 100%;
            }

            .kanban-board {
                grid-template-columns: 1fr;
            }

            .kanban-column {
                min-height: 200px;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="container">
        <div class="login-container">
            <h1>Feed Tulum Grants</h1>
            <p class="login-subtitle">Admin Access</p>

            <div id="errorMessage" class="error-message"></div>

            <form id="loginForm">
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required autofocus>
                </div>
                <button type="submit" class="btn" id="loginBtn">Login</button>
            </form>
        </div>
    </div>

    <!-- Dashboard Screen -->
    <div id="dashboardScreen" class="dashboard">
        <div class="dashboard-header">
            <h1>Feed Tulum Grants</h1>
            <button class="btn-logout" id="logoutBtn">Logout</button>
        </div>

        <div class="container" style="max-width: 1400px;">
            <div class="dashboard-content">
                <h2 style="margin-bottom: 1.5rem;">Grant Pipeline</h2>
                <div class="kanban-board">
                    <div class="kanban-column" id="column-consider">
                        <h3>To Consider</h3>
                        <div class="kanban-cards" id="cards-consider"></div>
                    </div>
                    <div class="kanban-column" id="column-progress">
                        <h3>In Progress</h3>
                        <div class="kanban-cards" id="cards-progress"></div>
                    </div>
                    <div class="kanban-column" id="column-submitted">
                        <h3>Submitted</h3>
                        <div class="kanban-cards" id="cards-submitted"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Real grant data
        let testGrants = [
            {
                id: "global-fund-children",
                name: "Global Fund for Children Partnership Grant",
                funder: "Global Fund for Children",
                amount: "$25,000 - $75,000",
                deadline: "Rolling",
                deadlineDate: null,
                priority: 4,
                status: "ready",
                description: "Partners with grassroots organizations worldwide working to improve lives of children and youth. Focuses on protecting children's rights, advancing youth leadership, and driving community-led change. Prefers local leadership, annual budget $25K-$75K, direct service to children.",
                whyWeQualify: "Feed Tulum is community-led (operates in Tulum, Mexico), works directly with children (orphanage support, food bank), partners with local organizations (Iglesia Camino Al Cielo), and led by people who live and work in the community.",
                instructions: [
                    "Visit globalfundforchildren.org and find partnership inquiry page",
                    "Submit Letter of Inquiry (LOI) through their online form",
                    "Answer their specific questions about community leadership and direct service",
                    "Emphasize local partnerships and grassroots nature",
                    "Describe how children benefit directly from programs",
                    "Include budget information ($25K-$75K range preferred)",
                    "Attach 501(c)(3) letter and Form 990 if requested",
                    "Mark as submitted after LOI sent"
                ],
                materials: {
                    letterOfInquiry: "LETTER OF INQUIRY - Global Fund for Children\n\nORGANIZATION INFORMATION:\nName: Feed Tulum (Tulum Food Support)\nEIN: 86-2375227\nStatus: U.S. 501(c)(3) nonprofit\nLocation: Tulum, Mexico\nAnnual Budget: [Enter current budget - should be under $200K]\nWebsite: feedtulum.com\nContact: feedtulum@gmail.com\n\nCOMMUNITY LEADERSHIP:\nFeed Tulum is led by individuals who live and work in Tulum, Mexico. Our team members are embedded in the local community and understand the specific challenges facing families and children here. We work alongside community members, not above them.\n\nDIRECT SERVICE TO CHILDREN:\nWe work directly with vulnerable children through three programs:\n\n1. Orphanage Partnership (under 20 children, expanding to 60)\n- Daily meals and nutrition support\n- English lessons taught by community volunteers\n- Yoga and wellness activities\n- Hands-on learning through permaculture farm\n- Post-graduation job placement support\n\nChildren participate directly in farm activities, learning to grow their own food while building skills for the future.\n\n2. Bi-Weekly Food Bank\nPartnership with Iglesia Camino Al Cielo distributes food kits to food-insecure families. Children in these families gain consistent access to nutrition.\n\n3. Tacos and Toys Holiday Event\nAnnual event provides meals, toys, and family experiences directly to local children.\n\nLOCAL PARTNERSHIPS:\nWe collaborate with:\n- Local orphanage (direct service site)\n- Iglesia Camino Al Cielo (food distribution partner)\n- Community volunteers (program delivery)\n- Local families (program beneficiaries)\n\nThese partnerships ensure programs are community-driven and culturally appropriate.\n\nIMPACT TO DATE:\n- Tens of thousands of meals distributed\n- Under 20 orphans receiving daily support (expanding capacity)\n- Dozens of families served through food bank\n- Farm producing fresh organic food for children\n\nWHY PARTNERSHIP MATTERS:\nGFC partnership would help us expand orphanage support to 60 children, strengthen our permaculture farm education program, and increase food bank capacity. This means more children with consistent nutrition and skills to build better futures.\n\nWe seek partnership with GFC because we share your commitment to grassroots, community-led change that puts children first.\n\nThank you for considering Feed Tulum for partnership.\n\nContact: feedtulum@gmail.com"
                }
            },
            {
                id: "cfh-foundation",
                name: "Conservation, Food & Health Foundation Grant",
                funder: "Conservation, Food & Health Foundation",
                amount: "$25,000 - $50,000 per year",
                deadline: "June 16, 2026",
                deadlineDate: "2026-06-16",
                priority: 5,
                status: "ready",
                description: "Supports food security and sustainable agriculture projects in Latin America, Asia, Africa, Caribbean, and Middle East. Focuses on research-based capacity building, self-sufficiency, climate resilience, and healthy nutrition. Two-phase application: concept note due June 16, 2026, then invited full proposals.",
                whyWeQualify: "Perfect fit: Feed Tulum operates in Mexico (Latin America), works with local partners (required for US nonprofits), combines immediate food security (food bank) with long-term capacity building (permaculture farm teaching children sustainable agriculture). Grant range $25K-$50K matches our budget.",
                instructions: [
                    "Visit cfhfoundation.grantsmanagement08.com",
                    "Login to grants portal using access code: cfhgrants",
                    "Complete online concept note application (Phase 1)",
                    "Describe permaculture farm and food bank programs",
                    "Emphasize local partnerships and sustainable food systems approach",
                    "Submit by June 16, 2026 deadline",
                    "If invited, complete full proposal (Phase 2)",
                    "Mark as submitted after concept note sent"
                ],
                materials: {
                    conceptNote: "CONCEPT NOTE - Conservation, Food & Health Foundation\n(Access portal at cfhfoundation.grantsmanagement08.com with code: cfhgrants)\n\nORGANIZATION INFORMATION:\nName: Feed Tulum (Tulum Food Support)\nEIN: 86-2375227\nStatus: U.S. 501(c)(3) nonprofit\nProject Location: Tulum, Quintana Roo, Mexico\nWebsite: feedtulum.com\nContact: feedtulum@gmail.com\n\nPROJECT TITLE:\nBuilding Food Security Through Permaculture Education and Community Food Distribution in Tulum, Mexico\n\nPROJECT SUMMARY:\nFeed Tulum addresses food insecurity in Tulum, Mexico through two integrated programs: (1) a permaculture farm at our partner orphanage that teaches children sustainable agriculture while producing nutritious food, and (2) a bi-weekly community food bank serving food-insecure families. This dual approach provides immediate food access while building long-term capacity for self-sufficiency.\n\nPROBLEM STATEMENT:\nFamilies in Tulum face food insecurity due to limited access to affordable, nutritious food. Orphaned children lack both consistent nutrition and skills for future self-sufficiency. Traditional food aid doesn't address root causes or build capacity for sustainable food systems.\n\nCAPACITY-BUILDING APPROACH:\nOur permaculture farm represents a shift from charity to capacity-building. Children learn to grow food using sustainable methods (companion planting, composting, rainwater harvesting). These skills create lifelong capacity for food self-sufficiency. The farm produces fresh vegetables for daily orphanage meals while serving as a living classroom.\n\nCLIMATE RESILIENCE:\nPermaculture methods build resilience against climate variability:\n- Water conservation through mulching and rainwater collection\n- Soil health through composting and no-till practices\n- Crop diversity reduces risk of total crop failure\n- Local adaptation to Tulum's tropical climate\n\nChildren learn climate-smart agriculture they can use throughout their lives, regardless of external aid availability.\n\nLOCAL PARTNERSHIPS (Required for US-based nonprofits):\n- Local orphanage: Host site, serves under 20 children (expanding to 60)\n- Iglesia Camino Al Cielo: Local church partner for food distribution\n- Community volunteers: Support farm education and food bank operations\n- Local families: Program beneficiaries and knowledge partners\n\nHEALTHY NUTRITION OUTCOMES:\n- Fresh organic vegetables in children's daily diet\n- Food bank provides tens of thousands of meals annually\n- Nutrition education through hands-on farm participation\n- Increased access to fresh produce in underserved community\n\nRESEARCH-BASED METHODS:\nOur permaculture approach draws on established research in sustainable agriculture, food security, and experiential education. We track outcomes: meals distributed, children participating in farm education, vegetables harvested, and families served.\n\nSELF-SUFFICIENCY GOAL:\nThe farm reduces orphanage dependence on purchased food while creating transferable skills. Children learn to produce their own food rather than depending on aid. This aligns with CFH's focus on self-sufficiency and capacity building.\n\nFUNDING REQUEST: $25,000-$50,000 per year\nSupport: Farm expansion and tools, seeds and supplies, nutrition education materials, food bank operations, local partnership coordination.\n\nWHY CFH SUPPORT MATTERS:\nCFH funding would expand our farm's capacity to serve 60 children (from current 20), strengthen nutrition education curriculum, and increase food bank reach. This means more children with both immediate nutrition and lifelong food production skills.\n\nALIGNMENT WITH CFH PRIORITIES:\nâœ“ Latin America geography (Mexico)\nâœ“ Food security focus\nâœ“ Capacity building (not just food distribution)\nâœ“ Climate resilience (permaculture methods)\nâœ“ Healthy nutrition (fresh produce)\nâœ“ Local partnerships (required for US nonprofits)\nâœ“ Research-based approach\nâœ“ Self-sufficiency goal\n\nContact: feedtulum@gmail.com"
                }
            }
        ];

        // Check if already authenticated
        function checkAuth() {
            const isAuthenticated = sessionStorage.getItem('authenticated') === 'true';
            if (isAuthenticated) {
                showDashboard();
                renderGrants();
            } else {
                showLogin();
            }
        }

        function showLogin() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('dashboardScreen').classList.remove('show');
        }

        function showDashboard() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('dashboardScreen').classList.add('show');
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
        }

        function hideError() {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.classList.remove('show');
        }

        // Handle login form submission
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');

            // Disable button and show loading state
            loginBtn.disabled = true;
            loginBtn.textContent = 'Logging in...';
            hideError();

            try {
                const response = await fetch('/api/auth', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ password })
                });

                const data = await response.json();

                if (data.success) {
                    // Store authentication in sessionStorage
                    sessionStorage.setItem('authenticated', 'true');
                    showDashboard();
                    renderGrants();
                } else {
                    showError(data.error || 'Invalid password');
                }
            } catch (error) {
                showError('Login failed. Please try again.');
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = 'Login';
            }
        });

        // Handle logout
        document.getElementById('logoutBtn').addEventListener('click', () => {
            sessionStorage.removeItem('authenticated');
            document.getElementById('password').value = '';
            showLogin();
        });

        // Calculate days until deadline
        function getDaysUntil(dateString) {
            if (!dateString) return null;
            const deadline = new Date(dateString);
            const today = new Date();
            const diffTime = deadline - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        // Generate priority stars
        function getPriorityStars(priority) {
            return 'â˜…'.repeat(priority) + 'â˜†'.repeat(5 - priority);
        }

        // Load card positions from localStorage
        function loadCardPositions() {
            const saved = localStorage.getItem('grantCardPositions');
            if (saved) {
                return JSON.parse(saved);
            }
            // Default: all grants in "consider" column
            const positions = { consider: [], progress: [], submitted: [] };
            testGrants.forEach(grant => {
                positions.consider.push(grant.id);
            });
            return positions;
        }

        // Save card positions to localStorage
        function saveCardPositions() {
            const positions = {
                consider: Array.from(document.getElementById('cards-consider').children).map(card => card.dataset.grantId),
                progress: Array.from(document.getElementById('cards-progress').children).map(card => card.dataset.grantId),
                submitted: Array.from(document.getElementById('cards-submitted').children).map(card => card.dataset.grantId)
            };
            localStorage.setItem('grantCardPositions', JSON.stringify(positions));
        }

        // Initialize SortableJS for all columns
        function initializeSortable() {
            const columns = ['consider', 'progress', 'submitted'];
            columns.forEach(col => {
                new Sortable(document.getElementById(`cards-${col}`), {
                    group: 'grants',
                    animation: 150,
                    ghostClass: 'sortable-ghost',
                    dragClass: 'sortable-drag',
                    onEnd: function(evt) {
                        saveCardPositions();
                    }
                });
            });
        }

        // Render all grants into Kanban columns
        function renderGrants() {
            // Load saved card positions
            const positions = loadCardPositions();

            // Function to create grant card HTML
            const createGrantCard = (grant) => {
                const daysUntil = getDaysUntil(grant.deadlineDate);
                const deadlineText = daysUntil !== null
                    ? `${grant.deadline} (${daysUntil} days left)`
                    : grant.deadline;

                // Determine deadline color
                let deadlineColor = '#2e7d32'; // green
                if (daysUntil !== null) {
                    if (daysUntil < 14) deadlineColor = '#c62828'; // red
                    else if (daysUntil < 30) deadlineColor = '#ef6c00'; // orange
                }

                return `
                    <div class="grant-card" data-grant-id="${grant.id}">
                        <div class="grant-header">
                            <div class="grant-title">
                                <h3>${grant.name}</h3>
                                <div class="grant-funder">${grant.funder}</div>
                            </div>
                            <div class="grant-meta">
                                <span class="grant-amount">${grant.amount}</span>
                                <span class="grant-deadline" style="color: ${deadlineColor}; font-weight: 500;">${deadlineText}</span>
                                <span class="priority-stars" title="${grant.priority} out of 5">${getPriorityStars(grant.priority)}</span>
                            </div>
                        </div>

                        <div class="grant-details">
                            <div class="detail-section">
                                <h4>Description</h4>
                                <p>${grant.description}</p>
                            </div>

                            <div class="detail-section">
                                <h4>Why We Qualify</h4>
                                <p>${grant.whyWeQualify}</p>
                            </div>

                            <div class="detail-section">
                                <h4>Application Materials</h4>
                                ${grant.materials.emailSubject ? `
                                    <div class="material-item">
                                        <div class="material-header">
                                            <span class="material-label">Email Subject:</span>
                                            <button class="btn-copy" onclick="copyToClipboard('subject-${grant.id}', this)">Copy</button>
                                        </div>
                                        <div class="material-content" id="subject-${grant.id}">${grant.materials.emailSubject}</div>
                                    </div>
                                ` : ''}
                                ${grant.materials.emailBody ? `
                                    <div class="material-item">
                                        <div class="material-header">
                                            <span class="material-label">Email Body:</span>
                                            <button class="btn-copy" onclick="copyToClipboard('body-${grant.id}', this)">Copy</button>
                                        </div>
                                        <div class="material-content" id="body-${grant.id}">${grant.materials.emailBody}</div>
                                    </div>
                                ` : ''}
                            </div>

                            <div class="detail-section">
                                <h4>Submission Instructions</h4>
                                <ul class="instructions-list">
                                    ${grant.instructions.map(step => `<li>${step}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            };

            // Clear all columns
            document.getElementById('cards-consider').innerHTML = '';
            document.getElementById('cards-progress').innerHTML = '';
            document.getElementById('cards-submitted').innerHTML = '';

            // Render grants into their respective columns
            ['consider', 'progress', 'submitted'].forEach(column => {
                const columnElement = document.getElementById(`cards-${column}`);
                positions[column].forEach(grantId => {
                    const grant = testGrants.find(g => g.id === grantId);
                    if (grant) {
                        columnElement.innerHTML += createGrantCard(grant);
                    }
                });
            });

            // Add click handlers to toggle expansion
            document.querySelectorAll('.grant-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    // Don't toggle if clicking on a button
                    if (e.target.tagName === 'BUTTON') return;
                    card.classList.toggle('expanded');
                });
            });

            // Initialize sortable after rendering
            initializeSortable();
        }

        // Copy to clipboard
        function copyToClipboard(elementId, button) {
            const element = document.getElementById(elementId);
            const text = element.textContent;

            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                setTimeout(() => {
                    button.textContent = originalText;
                }, 2000);
            });
        }


        // Check authentication on page load
        checkAuth();
    </script>
</body>
</html>
