<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feed Tulum Grants</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŒ®</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Source+Serif+4:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --terracotta: #C65D3B;
            --terracotta-dark: #A84E32;
            --sand: #F4F1DE;
            --jungle: #2C3E50;
            --cream: #FDFCF7;
            --text-dark: #1a1a1a;
            --text-medium: #4a4a4a;
            --text-light: #666;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            color: var(--text-dark);
            background-color: var(--sand);
            line-height: 1.6;
            min-height: 100vh;
        }

        h1, h2, h3 {
            font-family: 'Source Serif 4', Georgia, serif;
            color: var(--jungle);
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .login-container {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            margin-top: 100px;
        }

        .login-container h1 {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .login-subtitle {
            text-align: center;
            color: var(--text-medium);
            margin-bottom: 2rem;
            font-size: 0.95rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-dark);
        }

        input[type="password"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            font-family: inherit;
        }

        input[type="password"]:focus {
            outline: none;
            border-color: var(--terracotta);
        }

        .btn {
            width: 100%;
            padding: 0.875rem;
            background: var(--terracotta);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn:hover {
            background: var(--terracotta-dark);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .error-message {
            background: #fee;
            color: #c33;
            padding: 0.75rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .dashboard {
            display: none;
        }

        .dashboard.show {
            display: block;
        }

        .dashboard-header {
            background: white;
            padding: 1.5rem 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }

        .dashboard-header h1 {
            font-size: 1.5rem;
        }

        .btn-logout {
            padding: 0.5rem 1rem;
            background: transparent;
            color: var(--text-medium);
            border: 1px solid var(--text-medium);
            border-radius: 4px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            width: auto;
        }

        .btn-logout:hover {
            background: var(--jungle);
            color: white;
            border-color: var(--jungle);
        }

        .dashboard-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }

        .grants-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .grant-card {
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--cream);
        }

        .grant-card:hover {
            border-color: var(--terracotta);
            box-shadow: 0 2px 8px rgba(198, 93, 59, 0.1);
        }

        .grant-card.expanded {
            background: white;
            border-color: var(--terracotta);
        }

        .grant-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .grant-title {
            flex: 1;
            min-width: 200px;
        }

        .grant-title h3 {
            font-size: 1.15rem;
            margin-bottom: 0.25rem;
            color: var(--jungle);
        }

        .grant-funder {
            font-size: 0.9rem;
            color: var(--text-medium);
        }

        .grant-meta {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .grant-amount {
            font-weight: 600;
            color: var(--terracotta);
        }

        .grant-deadline {
            color: var(--text-medium);
            font-size: 0.9rem;
        }

        .priority-stars {
            color: var(--terracotta);
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .status-ready {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status-submitted {
            background: #e3f2fd;
            color: #1565c0;
        }

        .grant-details {
            display: none;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e0e0e0;
        }

        .grant-card.expanded .grant-details {
            display: block;
        }

        .detail-section {
            margin-bottom: 1.5rem;
        }

        .detail-section h4 {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            color: var(--jungle);
        }

        .detail-section p, .detail-section ul {
            color: var(--text-medium);
            font-size: 0.95rem;
        }

        .instructions-list {
            list-style: none;
            padding: 0;
        }

        .instructions-list li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .instructions-list li:before {
            content: "â†’";
            position: absolute;
            left: 0;
            color: var(--terracotta);
        }

        .material-item {
            background: var(--sand);
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
        }

        .material-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .material-label {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.9rem;
        }

        .btn-copy {
            padding: 0.25rem 0.75rem;
            background: var(--terracotta);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-copy:hover {
            background: var(--terracotta-dark);
        }

        .material-content {
            font-family: monospace;
            font-size: 0.85rem;
            color: var(--text-medium);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn-submit {
            padding: 0.5rem 1rem;
            background: var(--jungle);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-submit:hover {
            background: var(--text-dark);
        }

        .hidden {
            display: none;
        }

        /* Kanban Board Styles */
        .kanban-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .kanban-column {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            min-height: 400px;
        }

        .kanban-column h3 {
            font-size: 1rem;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--sand);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        #column-consider h3 {
            color: var(--text-medium);
            border-bottom-color: var(--text-medium);
        }

        #column-progress h3 {
            color: var(--terracotta);
            border-bottom-color: var(--terracotta);
        }

        #column-submitted h3 {
            color: #2e7d32;
            border-bottom-color: #2e7d32;
        }

        .kanban-cards {
            min-height: 300px;
        }

        .kanban-cards .grant-card {
            margin-bottom: 0.75rem;
            cursor: move;
        }

        .kanban-cards .grant-card:last-child {
            margin-bottom: 0;
        }

        .sortable-ghost {
            opacity: 0.4;
        }

        .sortable-drag {
            cursor: grabbing !important;
        }

        @media (max-width: 768px) {
            .grant-header {
                flex-direction: column;
            }

            .grant-meta {
                width: 100%;
                justify-content: space-between;
            }

            .dashboard-header {
                flex-direction: column;
                gap: 1rem;
            }

            .btn-logout {
                width: 100%;
            }

            .kanban-board {
                grid-template-columns: 1fr;
            }

            .kanban-column {
                min-height: 200px;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="container">
        <div class="login-container">
            <h1>Feed Tulum Grants</h1>
            <p class="login-subtitle">Admin Access</p>

            <div id="errorMessage" class="error-message"></div>

            <form id="loginForm">
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required autofocus>
                </div>
                <button type="submit" class="btn" id="loginBtn">Login</button>
            </form>
        </div>
    </div>

    <!-- Dashboard Screen -->
    <div id="dashboardScreen" class="dashboard">
        <div class="dashboard-header">
            <h1>Feed Tulum Grants</h1>
            <button class="btn-logout" id="logoutBtn">Logout</button>
        </div>

        <div class="container" style="max-width: 1400px;">
            <div class="dashboard-content">
                <h2 style="margin-bottom: 1.5rem;">Grant Pipeline</h2>
                <div class="kanban-board">
                    <div class="kanban-column" id="column-consider">
                        <h3>To Consider</h3>
                        <div class="kanban-cards" id="cards-consider"></div>
                    </div>
                    <div class="kanban-column" id="column-progress">
                        <h3>In Progress</h3>
                        <div class="kanban-cards" id="cards-progress"></div>
                    </div>
                    <div class="kanban-column" id="column-submitted">
                        <h3>Submitted</h3>
                        <div class="kanban-cards" id="cards-submitted"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Real grant data
        let testGrants = [
            {
                id: "global-fund-children",
                name: "Global Fund for Children Partnership",
                funder: "Global Fund for Children",
                amount: "$5,000 - $20,000/year",
                deadline: "Rolling",
                deadlineDate: null,
                priority: 5,
                status: "ready",
                description: "GFC partners with grassroots organizations serving children. Budget must be under $200K. 83% of grantees are first-time institutional funding recipients.",
                funderPriorities: "GFC prioritizes: (1) Locally-led orgs where leaders have lived experience in the community, (2) Grassroots approach - small, community-based, not large NGOs, (3) Direct work with children and youth, (4) Organizations led by women or young people, (5) First-time grantees welcome - they want to be your first funder.",
                whyWeQualify: "Locally-led (team lives in Tulum), 100% volunteer-run, small budget, direct service to children and youth, work with Mayan communities.",
                instructions: [
                    "Go to: https://globalfundforchildren.my.site.com/GFCGrants/s/expression-of-interest?language=en_US",
                    "Fill out the form (select Organization, enter address, etc.)",
                    "For the 3 narrative questions, paste the answers from materials below",
                    "Submit"
                ],
                materials: {
                    howOrgBegan: "Feed Tulum began when community members living in Tulum saw the stark divide between tourism prosperity and the difficult conditions facing many local residents. We witnessed neighbors without consistent access to nutritious food, medicine, and basic amenities. Rather than look away, we created pathways for people to give back. What started as neighbors helping neighbors has grown into a registered 501(c)(3) nonprofit with consistent programs serving children and families in need. We remain 100% volunteer-run, with no salaried staff, ensuring all funds go directly to our community programs.",
                    workWithChildren: "We work directly with children and youth through three core programs. First, we partner with a local orphanage, providing regular food supplies, English lessons, yoga classes, field trips, and job placement assistance for youth aging out of care. We recently launched an on-site permaculture farm where children learn sustainable agriculture while growing organic food for their meals. Second, our bi-weekly food bank, operated with local church Iglesia Camino Al Cielo, distributes free food kits to families, ensuring children have consistent access to nutrition. Third, our annual Tacos and Toys event brings joy to local children during the holidays with meals and gifts. We have distributed tens of thousands of free meals and countless clothing items to families and orphans.",
                    anythingElse: "Tulum is known worldwide as a tourist destination, but many local residents, including Indigenous Mayan families, live in conditions tourists never see. They work long hours in tourism jobs yet struggle to afford nutritious food for their children. Feed Tulum bridges this gap. Our team lives in Tulum - we are neighbors serving neighbors, not outsiders managing from abroad. Our permaculture farm teaches children to grow their own food, building self-sufficiency rather than dependence. We integrate Mayan agricultural knowledge, honoring our community's heritage. With no paid staff, 100% of donations fund programs. We seek partnership with GFC because we share your commitment to grassroots, community-led change that empowers children and youth."
                }
            },
            {
                id: "cfh-foundation",
                name: "Conservation, Food & Health Foundation Grant",
                funder: "Conservation, Food & Health Foundation",
                amount: "$25,000 - $50,000 per year",
                deadline: "June 16, 2026",
                deadlineDate: "2026-06-16",
                priority: 5,
                status: "ready",
                description: "Supports food security and sustainable agriculture projects in Latin America, Asia, Africa, Caribbean, and Middle East. Focuses on research-based capacity building, self-sufficiency, climate resilience, and healthy nutrition. Two-phase application: concept note due June 16, 2026, then invited full proposals.",
                whyWeQualify: "Perfect fit: Feed Tulum operates in Mexico (Latin America), works with local partners (required for US nonprofits), combines immediate food security (food bank) with long-term capacity building (permaculture farm teaching children sustainable agriculture). Grant range $25K-$50K matches our budget.",
                instructions: [
                    "Visit cfhfoundation.grantsmanagement08.com",
                    "Login to grants portal using access code: cfhgrants",
                    "Complete online concept note application (Phase 1)",
                    "Describe permaculture farm and food bank programs",
                    "Emphasize local partnerships and sustainable food systems approach",
                    "Submit by June 16, 2026 deadline",
                    "If invited, complete full proposal (Phase 2)",
                    "Mark as submitted after concept note sent"
                ],
                materials: {
                    conceptNote: "CONCEPT NOTE - Conservation, Food & Health Foundation\n(Access portal at cfhfoundation.grantsmanagement08.com with code: cfhgrants)\n\nORGANIZATION INFORMATION:\nName: Feed Tulum (Tulum Food Support)\nEIN: 86-2375227\nStatus: U.S. 501(c)(3) nonprofit\nProject Location: Tulum, Quintana Roo, Mexico\nWebsite: feedtulum.com\nContact: feedtulum@gmail.com\n\nPROJECT TITLE:\nBuilding Food Security Through Permaculture Education and Community Food Distribution in Tulum, Mexico\n\nPROJECT SUMMARY:\nFeed Tulum addresses food insecurity in Tulum, Mexico through two integrated programs: (1) a permaculture farm at our partner orphanage that teaches children sustainable agriculture while producing nutritious food, and (2) a bi-weekly community food bank serving food-insecure families. This dual approach provides immediate food access while building long-term capacity for self-sufficiency.\n\nPROBLEM STATEMENT:\nFamilies in Tulum face food insecurity due to limited access to affordable, nutritious food. Orphaned children lack both consistent nutrition and skills for future self-sufficiency. Traditional food aid doesn't address root causes or build capacity for sustainable food systems.\n\nCAPACITY-BUILDING APPROACH:\nOur permaculture farm represents a shift from charity to capacity-building. Children learn to grow food using sustainable methods (companion planting, composting, rainwater harvesting). These skills create lifelong capacity for food self-sufficiency. The farm produces fresh vegetables for daily orphanage meals while serving as a living classroom.\n\nCLIMATE RESILIENCE:\nPermaculture methods build resilience against climate variability:\n- Water conservation through mulching and rainwater collection\n- Soil health through composting and no-till practices\n- Crop diversity reduces risk of total crop failure\n- Local adaptation to Tulum's tropical climate\n\nChildren learn climate-smart agriculture they can use throughout their lives, regardless of external aid availability.\n\nLOCAL PARTNERSHIPS (Required for US-based nonprofits):\n- Local orphanage: Host site, serves under 20 children (expanding to 60)\n- Iglesia Camino Al Cielo: Local church partner for food distribution\n- Community volunteers: Support farm education and food bank operations\n- Local families: Program beneficiaries and knowledge partners\n\nHEALTHY NUTRITION OUTCOMES:\n- Fresh organic vegetables in children's daily diet\n- Food bank provides tens of thousands of meals annually\n- Nutrition education through hands-on farm participation\n- Increased access to fresh produce in underserved community\n\nRESEARCH-BASED METHODS:\nOur permaculture approach draws on established research in sustainable agriculture, food security, and experiential education. We track outcomes: meals distributed, children participating in farm education, vegetables harvested, and families served.\n\nSELF-SUFFICIENCY GOAL:\nThe farm reduces orphanage dependence on purchased food while creating transferable skills. Children learn to produce their own food rather than depending on aid. This aligns with CFH's focus on self-sufficiency and capacity building.\n\nFUNDING REQUEST: $25,000-$50,000 per year\nSupport: Farm expansion and tools, seeds and supplies, nutrition education materials, food bank operations, local partnership coordination.\n\nWHY CFH SUPPORT MATTERS:\nCFH funding would expand our farm's capacity to serve 60 children (from current 20), strengthen nutrition education curriculum, and increase food bank reach. This means more children with both immediate nutrition and lifelong food production skills.\n\nALIGNMENT WITH CFH PRIORITIES:\nâœ“ Latin America geography (Mexico)\nâœ“ Food security focus\nâœ“ Capacity building (not just food distribution)\nâœ“ Climate resilience (permaculture methods)\nâœ“ Healthy nutrition (fresh produce)\nâœ“ Local partnerships (required for US nonprofits)\nâœ“ Research-based approach\nâœ“ Self-sufficiency goal\n\nContact: feedtulum@gmail.com"
                }
            },
            {
                id: "wk-kellogg",
                name: "W.K. Kellogg Foundation ðŸŽ¯ PRIORITY REGION",
                funder: "W.K. Kellogg Foundation",
                amount: "$30,000 - $100,000+",
                deadline: "Rolling",
                deadlineDate: null,
                priority: 5,
                status: "ready",
                description: "TULUM IS IN WKKF'S PRIORITY YUCATAN PENINSULA REGION! They committed to generational investment in Quintana Roo. Funds food systems, thriving children, working families. Past grant in this region: nutrition and education for Mayan children. US 501c3s CAN apply for Mexico work. Response in 30 days.",
                whyWeQualify: "PERFECT GEOGRAPHIC FIT: Quintana Roo is WKKF priority region. PROGRAM FIT: Food systems (farm, food bank), thriving children (orphanage), working families (food bank), education (English, agriculture), health (nutrition), racial equity (Mayan community).",
                instructions: [
                    "Visit wkkf.fluxx.io or wkkf.org/grantseekers",
                    "Register for Fluxx portal account",
                    "Submit Letter of Inquiry (LOI) - 250-300 words max (1500 characters)",
                    "CRITICAL: Emphasize Quintana Roo/Yucatan Peninsula location",
                    "Highlight multiple priorities: food systems, children, families, equity",
                    "Mention Mayan community (racial equity focus)",
                    "Include 1-2 specific impact numbers",
                    "Response within 30 business days",
                    "If invited, submit full proposal",
                    "Mark as submitted after LOI sent"
                ],
                materials: {
                    letterOfInquiry: "LETTER OF INQUIRY - W.K. Kellogg Foundation\n(Submit via Fluxx at wkkf.fluxx.io - MAX 1500 characters)\n\nVERSION 1 - MULTI-PRIORITY (1485 chars):\n\nFeed Tulum requests support to expand food systems, education, and nutrition programs serving vulnerable children and working families in Tulum, Quintana Roo, Mexicoâ€”located in WKKF's priority Yucatan Peninsula region.\n\nGEOGRAPHIC ALIGNMENT: Our work directly serves communities in Quintana Roo, one of WKKF's 25 priority municipalities in the Yucatan Peninsula identified for generational investment.\n\nPROGRAM ALIGNMENT:\n\nTHRIVING CHILDREN: We partner with a local orphanage serving children with Mayan heritage, providing daily nutrition, education, and skills training. We're expanding from 20 to 60 children.\n\nFOOD SYSTEMS: Our permaculture farm teaches children sustainable agriculture while producing fresh organic food. This builds food security and transfers traditional Mayan agricultural knowledge to the next generation.\n\nWORKING FAMILIES: Bi-weekly food bank serves food-insecure working families in Tulum through partnership with local church Iglesia Camino Al Cielo.\n\nEDUCATION: English lessons and agricultural education prepare children for economic opportunity. Farm-based learning connects nutrition, sustainability, and traditional knowledge.\n\nEQUITABLE COMMUNITIES: Community-led model engages local volunteers as educators and mentors, building community capacity and leadership.\n\nMEASURABLE IMPACT: Tens of thousands of meals distributed annually. Expanding orphanage capacity 3x. Tracking nutrition outcomes, educational progress, farm production.\n\nRACIAL EQUITY: Serving primarily Mayan children and families experiencing systemic disadvantage in food access, education, and economic opportunity.\n\nFUNDING REQUEST: $40,000 to expand farm capacity, strengthen nutrition programs, and serve more children in WKKF's priority Yucatan Peninsula geography.\n\nContact: feedtulum@gmail.com\n\n---\n\nVERSION 2 - FOOD SYSTEMS FOCUS (1463 chars):\n\nFeed Tulum seeks partnership to build sustainable food systems for thriving children in Tulum, Quintana Roo, Mexicoâ€”WKKF's priority Yucatan Peninsula region.\n\nGEOGRAPHIC MATCH: We operate in Quintana Roo, one of WKKF's 25 priority municipalities in the Yucatan Peninsula committed to generational investment.\n\nFOOD SYSTEMS TRANSFORMATION: We're shifting from food charity to food capacity-building through integrated programs:\n\n1) PERMACULTURE EDUCATION: Children learn sustainable agriculture, producing fresh food while gaining skills for self-sufficiency. Farm serves as living classroom connecting nutrition, traditional Mayan agricultural practices, and climate resilience.\n\n2) COMMUNITY FOOD BANK: Bi-weekly distribution through local church partnership serves working families struggling with food insecurity.\n\n3) NUTRITION EDUCATION: Hands-on farm participation teaches children where food comes from and how to grow it themselves.\n\nTHRIVING CHILDREN: Orphanage partnership provides daily nutrition, education, and holistic support to 20 children (expanding to 60). Children with Mayan heritage gain both immediate food security and long-term agricultural skills.\n\nCOMMUNITY-LED: Local volunteers deliver education. Local church partners on distribution. Local agricultural knowledge integrated into curriculum.\n\nEQUITY FOCUS: Serving Mayan children and families experiencing systemic disadvantage in food access and economic opportunity.\n\nMEASURABLE OUTCOMES: Tracking meals distributed, children served, farm production, nutrition improvements, skill development.\n\nFUNDING: $40,000 to scale farm-based education from 20 to 60 children in WKKF's Yucatan Peninsula priority region.\n\nContact: feedtulum@gmail.com\n\n---\n\nSUBMISSION TIPS:\n- Use Version 1 for broad alignment\n- Verify character count (max 1500 including spaces)\n- Lead with Quintana Roo/Yucatan Peninsula\n- Include specific numbers\n- Mention Mayan community"
                }
            },
            {
                id: "iaf-mexico",
                name: "Inter-American Foundation ðŸ‡²ðŸ‡½ REQUIRES MX NONPROFIT",
                funder: "Inter-American Foundation",
                amount: "$25,000 - $400,000 over 4 years",
                deadline: "Rolling",
                deadlineDate: null,
                priority: 4,
                status: "ready",
                description: "ðŸ‡²ðŸ‡½ REQUIRES MEXICAN NONPROFIT STATUS: Must be local organization BASED in Mexico. Once Feed Tulum establishes Mexican A.C. (AsociaciÃ³n Civil), will qualify. Funds community-led food security, grassroots projects, sustainable agriculture. Requires counterpart resources (we have volunteers, partnerships, land).",
                whyWeQualify: "PERFECT FIT once MX nonprofit: Community-led in Tulum, food security focus (Global Food Security Strategy priority), grassroots approach, children/nutrition programs, counterpart resources (volunteers, partnerships, infrastructure), sustainability plan.",
                instructions: [
                    "ðŸ‡²ðŸ‡½ PREREQUISITE: Establish Mexican nonprofit (AsociaciÃ³n Civil) first",
                    "Obtain CLUNI registration (required for Mexican nonprofits)",
                    "Visit iaf.gov/apply-for-grant",
                    "Review eligibility: must be BASED in Mexico, community-led",
                    "Prepare proposal showing counterpart resources",
                    "Emphasize food security alignment with Global Food Security Strategy",
                    "Submit through IAF online system",
                    "Response typically 4-6 months",
                    "Mark as submitted after proposal sent"
                ],
                materials: {
                    proposal: "PROPOSAL - Inter-American Foundation\n(Submit once Mexican nonprofit established)\n\nORGANIZATION:\nName: Feed Tulum Mexico A.C. [to be registered]\nStatus: Mexican AsociaciÃ³n Civil\nCLUNI: [to be obtained]\nLocation: Tulum, Quintana Roo, Mexico\nWebsite: feedtulum.com\nContact: feedtulum@gmail.com\n\nCOMMUNITY-LED:\nFeed Tulum is led by people who LIVE in Tulum. We are embedded in the community, working alongside neighbors as equals.\n\nFOOD SECURITY (IAF Priority):\n1. Permaculture Farm - Children learn sustainable agriculture, produces fresh food, builds climate resilience\n2. Food Bank - Bi-weekly distribution, tens of thousands of meals annually\n3. Nutrition Education - Hands-on learning through farm participation\n\nGRASSROOTS IMPACT:\n- Under 20 orphaned children (expanding to 60)\n- Dozens of food-insecure families served\n- Community volunteers engaged\n\nCOUNTERPART RESOURCES (Required):\n- Volunteer labor (teachers, farm educators, food bank volunteers)\n- Local partnerships (orphanage, church)\n- Land and infrastructure\n- Community knowledge\n\nSUSTAINABILITY:\n- Farm produces ongoing food\n- Children trained teach others\n- Partnerships continue support\n- Skills transfer creates self-sufficiency\n\nFUNDING REQUEST: $100,000 over 4 years\n($25,000/year: farm expansion, food bank, nutrition education)\n\nALIGNMENT:\nâœ“ Based in Mexico (required)\nâœ“ Community-led\nâœ“ Food security (Global Food Security Strategy)\nâœ“ Grassroots approach\nâœ“ Counterpart resources\nâœ“ Sustainability path\n\nContact: feedtulum@gmail.com"
                }
            },
            {
                id: "fundacion-cozumel",
                name: "FundaciÃ³n Comunitaria Cozumel ðŸ‡²ðŸ‡½ REQUIRES MX NONPROFIT",
                funder: "FundaciÃ³n Comunitaria Cozumel I.A.P.",
                amount: "Varies (local Quintana Roo grants)",
                deadline: "Rolling (contact for cycles)",
                deadlineDate: null,
                priority: 4,
                status: "ready",
                description: "ðŸ‡²ðŸ‡½ REQUIRES MEXICAN NONPROFIT: First community foundation in Quintana Roo! Funds LOCAL nonprofits serving children. Tulum is in Quintana Roo (same state). Focus: orphanages, schools, children's programs, educational equipment. Perfect local fit once MX nonprofit established.",
                whyWeQualify: "GEOGRAPHIC PERFECT MATCH: Tulum is in Quintana Roo (same state as Cozumel). Once MX nonprofit established, Feed Tulum becomes local Quintana Roo organization. Programs align: orphanage, children's education, nutrition, vulnerable children with limited resources.",
                instructions: [
                    "ðŸ‡²ðŸ‡½ PREREQUISITE: Establish Mexican A.C. in Quintana Roo",
                    "Obtain CLUNI registration",
                    "Visit fundacioncozumel.org",
                    "Contact foundation about current grant cycles",
                    "Prepare proposal highlighting Quintana Roo location",
                    "Emphasize orphanage support, children's programs, nutrition",
                    "Submit following their guidelines",
                    "Mark as submitted"
                ],
                materials: {
                    proposal: "PROPOSAL - FundaciÃ³n Comunitaria Cozumel\n(Submit once MX nonprofit in Quintana Roo)\n\nORGANIZATION:\nName: Feed Tulum Mexico A.C. [to be registered]\nStatus: Mexican AsociaciÃ³n Civil\nCLUNI: [to be obtained]\nLocation: Tulum, Quintana Roo, Mexico (SAME STATE)\nWebsite: feedtulum.com\nContact: feedtulum@gmail.com\n\nQUINTANA ROO LOCAL:\nFeed Tulum operates in Tulum, Quintana Roo - serving vulnerable children in our shared state.\n\nALIGNMENT WITH MISSION:\nYou support orphanages, schools, children's programs, educational equipment. We provide:\n\n1. ORPHANAGE SUPPORT\n- Partnership with local orphanage\n- Under 20 children, expanding to 60\n- Daily nutrition, education, skills training\n\n2. CHILDREN'S EDUCATION\n- English lessons by volunteers\n- Agricultural education through farm\n- Job placement support\n\n3. NUTRITION PROGRAMS\n- Fresh food from permaculture farm\n- Bi-weekly food bank\n- Nutrition education\n\n4. RECREATION\n- Yoga and wellness\n- Farm activities\n- Annual Tacos and Toys event\n\nPOPULATION SERVED:\nVulnerable Quintana Roo children:\n- Orphaned children\n- Food-insecure families\n- Children without nutrition access\n\nPROJECT:\nExpand orphanage capacity, upgrade farm equipment, develop curriculum, strengthen nutrition programs.\n\nFUNDING REQUEST: [Based on guidelines]\nOrphanage operations, education, nutrition, farm equipment.\n\nALIGNMENT:\nâœ“ Quintana Roo local organization\nâœ“ Children with limited resources\nâœ“ Orphanage support\nâœ“ Educational programs\nâœ“ Nutrition focus\nâœ“ Mexican nonprofit (A.C.)\n\nContact: feedtulum@gmail.com"
                }
            },
            {
                id: "fundacion-televisa",
                name: "FundaciÃ³n Televisa ðŸ‡²ðŸ‡½ REQUIRES MX NONPROFIT",
                funder: "FundaciÃ³n Televisa",
                amount: "Varies (programs for Mexican nonprofits)",
                deadline: "Contact for current programs",
                deadlineDate: null,
                priority: 3,
                status: "ready",
                description: "ðŸ‡²ðŸ‡½ REQUIRES MEXICAN NONPROFIT: Major Mexican foundation focused on education, health, nutrition of children/youth. Serves low-income families. 3.7M+ students benefited. Once MX nonprofit established, Feed Tulum qualifies as Mexican organization serving vulnerable children.",
                whyWeQualify: "MISSION ALIGNMENT once MX nonprofit: Education (English, farm education), health (nutrition programs), nutrition (food bank, fresh produce), children/youth (orphanage), target: low-income families in Mexico.",
                instructions: [
                    "ðŸ‡²ðŸ‡½ PREREQUISITE: Establish Mexican A.C. first",
                    "Obtain CLUNI registration",
                    "Research current FundaciÃ³n Televisa programs",
                    "Visit fundaciontelevisa.org or contact via social media",
                    "Inquire about partnership opportunities",
                    "Prepare proposal: education, health, nutrition for vulnerable children",
                    "Follow their application process",
                    "Mark as submitted"
                ],
                materials: {
                    inquiry: "PARTNERSHIP INQUIRY - FundaciÃ³n Televisa\n(Submit once MX nonprofit established)\n\nORGANIZATION:\nName: Feed Tulum Mexico A.C. [to be registered]\nStatus: Mexican AsociaciÃ³n Civil\nCLUNI: [to be obtained]\nLocation: Tulum, Quintana Roo, Mexico\nWebsite: feedtulum.com\nContact: feedtulum@gmail.com\n\nALIGNMENT (Education, Health, Nutrition):\n\n1. EDUCATION\n- English lessons for orphaned children\n- Agricultural education through farm\n- Life skills, job placement\n\n2. HEALTH\n- Nutrition programs address malnutrition\n- Yoga and wellness\n- Fresh organic produce\n\n3. NUTRITION\n- Daily meals for orphaned children\n- Permaculture farm producing vegetables\n- Bi-weekly food bank\n- Nutrition education\n\nTARGET POPULATION:\nLow-income families, vulnerable children in Tulum:\n- Orphaned children\n- Working families unable to afford nutritious food\n- Youth lacking opportunities\n\nREACH:\n- Under 20 orphaned children (expanding to 60)\n- Tens of thousands of meals annually\n- Dozens of food-insecure families\n\nPROGRAM:\nIntegrated education, health, nutrition for vulnerable Mexican children through orphanage partnership, permaculture farm, community food bank.\n\nPARTNERSHIP OPPORTUNITY:\nAs Mexican nonprofit serving low-income families, Feed Tulum seeks collaboration with FundaciÃ³n Televisa to expand reach and impact.\n\nALIGNMENT:\nâœ“ Mexican nonprofit\nâœ“ Education focus\nâœ“ Health programs\nâœ“ Nutrition initiatives\nâœ“ Serves children/youth\nâœ“ Low-income families\n\nContact: feedtulum@gmail.com"
                }
            }
        ];

        // Check if already authenticated
        function checkAuth() {
            const isAuthenticated = sessionStorage.getItem('authenticated') === 'true';
            if (isAuthenticated) {
                showDashboard();
                renderGrants();
            } else {
                showLogin();
            }
        }

        function showLogin() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('dashboardScreen').classList.remove('show');
        }

        function showDashboard() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('dashboardScreen').classList.add('show');
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
        }

        function hideError() {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.classList.remove('show');
        }

        // Handle login form submission
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');

            // Disable button and show loading state
            loginBtn.disabled = true;
            loginBtn.textContent = 'Logging in...';
            hideError();

            try {
                const response = await fetch('/api/auth', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ password })
                });

                const data = await response.json();

                if (data.success) {
                    // Store authentication in sessionStorage
                    sessionStorage.setItem('authenticated', 'true');
                    showDashboard();
                    renderGrants();
                } else {
                    showError(data.error || 'Invalid password');
                }
            } catch (error) {
                showError('Login failed. Please try again.');
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = 'Login';
            }
        });

        // Handle logout
        document.getElementById('logoutBtn').addEventListener('click', () => {
            sessionStorage.removeItem('authenticated');
            document.getElementById('password').value = '';
            showLogin();
        });

        // Calculate days until deadline
        function getDaysUntil(dateString) {
            if (!dateString) return null;
            const deadline = new Date(dateString);
            const today = new Date();
            const diffTime = deadline - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        // Generate priority stars
        function getPriorityStars(priority) {
            return 'â˜…'.repeat(priority) + 'â˜†'.repeat(5 - priority);
        }

        // Load card positions from localStorage
        function loadCardPositions() {
            const saved = localStorage.getItem('grantCardPositions');
            let positions;

            if (saved) {
                positions = JSON.parse(saved);
            } else {
                // Default: empty columns
                positions = { consider: [], progress: [], submitted: [] };
            }

            // Find all grant IDs that are currently in positions
            const existingIds = new Set([
                ...positions.consider,
                ...positions.progress,
                ...positions.submitted
            ]);

            // Add any new grants that aren't in saved positions to "consider" column
            testGrants.forEach(grant => {
                if (!existingIds.has(grant.id)) {
                    positions.consider.push(grant.id);
                    console.log('Adding new grant to consider column:', grant.id);
                }
            });

            return positions;
        }

        // Save card positions to localStorage
        function saveCardPositions() {
            const positions = {
                consider: Array.from(document.getElementById('cards-consider').children).map(card => card.dataset.grantId),
                progress: Array.from(document.getElementById('cards-progress').children).map(card => card.dataset.grantId),
                submitted: Array.from(document.getElementById('cards-submitted').children).map(card => card.dataset.grantId)
            };
            localStorage.setItem('grantCardPositions', JSON.stringify(positions));
        }

        // Initialize SortableJS for all columns
        function initializeSortable() {
            const columns = ['consider', 'progress', 'submitted'];
            columns.forEach(col => {
                new Sortable(document.getElementById(`cards-${col}`), {
                    group: 'grants',
                    animation: 150,
                    ghostClass: 'sortable-ghost',
                    dragClass: 'sortable-drag',
                    onEnd: function(evt) {
                        saveCardPositions();
                    }
                });
            });
        }

        // Helper function to escape HTML
        function escapeHtml(text) {
            if (!text) return '';
            return String(text)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        // Helper function to make URLs clickable
        function linkify(text) {
            if (!text) return '';

            // First escape HTML to prevent XSS
            const escaped = escapeHtml(text);

            // Regex to match URLs (http, https, www)
            const urlRegex = /(https?:\/\/[^\s<]+|www\.[^\s<]+)/g;

            // Replace URLs with clickable links
            return escaped.replace(urlRegex, function(url) {
                let href = url;
                // Add https:// if URL starts with www
                if (url.startsWith('www.')) {
                    href = 'https://' + url;
                }
                return '<a href="' + href + '" target="_blank" rel="noopener noreferrer" style="color: #1976d2; text-decoration: underline;">' + url + '</a>';
            });
        }

        // Helper function to render materials
        function renderMaterials(grant) {
            try {
                if (!grant.materials) return '';

                const labelMap = {
                    'emailSubject': 'Email Subject',
                    'emailBody': 'Email Body',
                    'letterOfInquiry': 'Letter of Inquiry',
                    'conceptNote': 'Concept Note',
                    'proposal': 'Proposal',
                    'inquiry': 'Partnership Inquiry',
                    'howOrgBegan': 'How your organization began',
                    'workWithChildren': 'Work with children and youth',
                    'anythingElse': 'Anything else to share'
                };

                let html = '';
                let index = 0;
                for (const key in grant.materials) {
                    const materialId = 'material-' + grant.id + '-' + index;
                    const label = labelMap[key] || key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                    const content = linkify(grant.materials[key]); // Use linkify to make URLs clickable
                    html += '<div class="material-item">';
                    html += '<div class="material-header">';
                    html += '<span class="material-label">' + label + ':</span>';
                    html += '<button class="btn-copy" onclick="copyToClipboard(\'' + materialId + '\', this)">Copy</button>';
                    html += '</div>';
                    html += '<div class="material-content" id="' + materialId + '">' + content + '</div>';
                    html += '</div>';
                    index++;
                }
                return html;
            } catch (error) {
                console.error('Error rendering materials for grant:', grant.id, error);
                return '<p style="color: red;">Error loading materials</p>';
            }
        }

        // Render all grants into Kanban columns
        function renderGrants() {
            try {
                console.log('renderGrants called, total grants:', testGrants.length);

                // Load saved card positions
                const positions = loadCardPositions();

                // Function to create grant card HTML
                const createGrantCard = (grant) => {
                    try {
                        console.log('Creating card for grant:', grant.id);
                const daysUntil = getDaysUntil(grant.deadlineDate);
                const deadlineText = daysUntil !== null
                    ? `${grant.deadline} (${daysUntil} days left)`
                    : grant.deadline;

                // Determine deadline color
                let deadlineColor = '#2e7d32'; // green
                if (daysUntil !== null) {
                    if (daysUntil < 14) deadlineColor = '#c62828'; // red
                    else if (daysUntil < 30) deadlineColor = '#ef6c00'; // orange
                }

                const materialsHtml = renderMaterials(grant);
                const instructionsHtml = grant.instructions.map(step => `<li>${linkify(step)}</li>`).join('');

                return `
                    <div class="grant-card" data-grant-id="${grant.id}">
                        <div class="grant-header">
                            <div class="grant-title">
                                <h3>${grant.name}</h3>
                                <div class="grant-funder">${grant.funder}</div>
                            </div>
                            <div class="grant-meta">
                                <span class="grant-amount">${grant.amount}</span>
                                <span class="grant-deadline" style="color: ${deadlineColor}; font-weight: 500;">${deadlineText}</span>
                                <span class="priority-stars" title="${grant.priority} out of 5">${getPriorityStars(grant.priority)}</span>
                            </div>
                        </div>

                        <div class="grant-details">
                            <div class="detail-section">
                                <h4>Description</h4>
                                <p>${linkify(grant.description)}</p>
                            </div>

                            ${grant.funderPriorities ? `<div class="detail-section">
                                <h4>What They Look For</h4>
                                <p>${linkify(grant.funderPriorities)}</p>
                            </div>` : ''}

                            <div class="detail-section">
                                <h4>Why We Qualify</h4>
                                <p>${linkify(grant.whyWeQualify)}</p>
                            </div>

                            <div class="detail-section">
                                <h4>Application Materials</h4>
                                ${materialsHtml}
                            </div>

                            <div class="detail-section">
                                <h4>Submission Instructions</h4>
                                <ul class="instructions-list">
                                    ${instructionsHtml}
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
                    } catch (error) {
                        console.error('Error creating grant card:', grant.id, error);
                        return `<div class="grant-card"><p style="color: red;">Error loading grant: ${grant.id}</p></div>`;
                    }
            };

            // Clear all columns
            document.getElementById('cards-consider').innerHTML = '';
            document.getElementById('cards-progress').innerHTML = '';
            document.getElementById('cards-submitted').innerHTML = '';

            // Render grants into their respective columns
            ['consider', 'progress', 'submitted'].forEach(column => {
                const columnElement = document.getElementById(`cards-${column}`);
                positions[column].forEach(grantId => {
                    const grant = testGrants.find(g => g.id === grantId);
                    if (grant) {
                        columnElement.innerHTML += createGrantCard(grant);
                    }
                });
            });

            // Add click handlers to toggle expansion
            document.querySelectorAll('.grant-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    // Don't toggle if clicking on a button or link
                    if (e.target.tagName === 'BUTTON' || e.target.tagName === 'A') return;
                    card.classList.toggle('expanded');
                });
            });

            // Initialize sortable after rendering
            initializeSortable();

            console.log('renderGrants completed successfully');
            } catch (error) {
                console.error('Error in renderGrants:', error);
                alert('Error loading grants. Check browser console for details.');
            }
        }

        // Copy to clipboard
        function copyToClipboard(elementId, button) {
            const element = document.getElementById(elementId);
            const text = element.textContent;

            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                setTimeout(() => {
                    button.textContent = originalText;
                }, 2000);
            });
        }


        // Check authentication on page load
        checkAuth();
    </script>
</body>
</html>
