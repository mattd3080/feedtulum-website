<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feed Tulum Grants</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŒ®</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Source+Serif+4:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --terracotta: #C65D3B;
            --terracotta-dark: #A84E32;
            --sand: #F4F1DE;
            --jungle: #2C3E50;
            --cream: #FDFCF7;
            --text-dark: #1a1a1a;
            --text-medium: #4a4a4a;
            --text-light: #666;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            color: var(--text-dark);
            background-color: var(--sand);
            line-height: 1.6;
            min-height: 100vh;
        }

        h1, h2, h3 {
            font-family: 'Source Serif 4', Georgia, serif;
            color: var(--jungle);
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .login-container {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            margin-top: 100px;
        }

        .login-container h1 {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .login-subtitle {
            text-align: center;
            color: var(--text-medium);
            margin-bottom: 2rem;
            font-size: 0.95rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-dark);
        }

        input[type="password"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            font-family: inherit;
        }

        input[type="password"]:focus {
            outline: none;
            border-color: var(--terracotta);
        }

        .btn {
            width: 100%;
            padding: 0.875rem;
            background: var(--terracotta);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn:hover {
            background: var(--terracotta-dark);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .error-message {
            background: #fee;
            color: #c33;
            padding: 0.75rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .dashboard {
            display: none;
        }

        .dashboard.show {
            display: block;
        }

        .dashboard-header {
            background: white;
            padding: 1.5rem 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }

        .dashboard-header h1 {
            font-size: 1.5rem;
        }

        .btn-logout {
            padding: 0.5rem 1rem;
            background: transparent;
            color: var(--text-medium);
            border: 1px solid var(--text-medium);
            border-radius: 4px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            width: auto;
        }

        .btn-logout:hover {
            background: var(--jungle);
            color: white;
            border-color: var(--jungle);
        }

        .dashboard-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }

        .grants-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .grant-card {
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--cream);
        }

        .grant-card:hover {
            border-color: var(--terracotta);
            box-shadow: 0 2px 8px rgba(198, 93, 59, 0.1);
        }

        .grant-card.expanded {
            background: white;
            border-color: var(--terracotta);
        }

        .grant-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .grant-title {
            flex: 1;
            min-width: 200px;
        }

        .grant-title h3 {
            font-size: 1.15rem;
            margin-bottom: 0.25rem;
            color: var(--jungle);
        }

        .grant-funder {
            font-size: 0.9rem;
            color: var(--text-medium);
        }

        .grant-meta {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .grant-amount {
            font-weight: 600;
            color: var(--terracotta);
        }

        .grant-deadline {
            color: var(--text-medium);
            font-size: 0.9rem;
        }

        .priority-stars {
            color: var(--terracotta);
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .status-ready {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status-submitted {
            background: #e3f2fd;
            color: #1565c0;
        }

        .grant-details {
            display: none;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e0e0e0;
        }

        .grant-card.expanded .grant-details {
            display: block;
        }

        .detail-section {
            margin-bottom: 1.5rem;
        }

        .detail-section h4 {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            color: var(--jungle);
        }

        .detail-section p, .detail-section ul {
            color: var(--text-medium);
            font-size: 0.95rem;
        }

        .instructions-list {
            list-style: none;
            padding: 0;
        }

        .instructions-list li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .instructions-list li:before {
            content: "â†’";
            position: absolute;
            left: 0;
            color: var(--terracotta);
        }

        .material-item {
            background: var(--sand);
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
        }

        .material-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .material-label {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.9rem;
        }

        .btn-copy {
            padding: 0.25rem 0.75rem;
            background: var(--terracotta);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-copy:hover {
            background: var(--terracotta-dark);
        }

        .material-content {
            font-family: monospace;
            font-size: 0.85rem;
            color: var(--text-medium);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn-submit {
            padding: 0.5rem 1rem;
            background: var(--jungle);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-submit:hover {
            background: var(--text-dark);
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .grant-header {
                flex-direction: column;
            }

            .grant-meta {
                width: 100%;
                justify-content: space-between;
            }

            .dashboard-header {
                flex-direction: column;
                gap: 1rem;
            }

            .btn-logout {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="container">
        <div class="login-container">
            <h1>Feed Tulum Grants</h1>
            <p class="login-subtitle">Admin Access</p>

            <div id="errorMessage" class="error-message"></div>

            <form id="loginForm">
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required autofocus>
                </div>
                <button type="submit" class="btn" id="loginBtn">Login</button>
            </form>
        </div>
    </div>

    <!-- Dashboard Screen -->
    <div id="dashboardScreen" class="dashboard">
        <div class="dashboard-header">
            <h1>Feed Tulum Grants</h1>
            <button class="btn-logout" id="logoutBtn">Logout</button>
        </div>

        <div class="container">
            <div class="dashboard-content">
                <h2 style="margin-bottom: 1.5rem;">Available Grants</h2>
                <div id="grantsList" class="grants-list"></div>
            </div>
        </div>
    </div>

    <script>
        // Load saved statuses from localStorage
        function loadGrantStatuses() {
            const saved = localStorage.getItem('grantStatuses');
            return saved ? JSON.parse(saved) : {};
        }

        // Save grant statuses to localStorage
        function saveGrantStatuses(statuses) {
            localStorage.setItem('grantStatuses', JSON.stringify(statuses));
        }

        // Real grant data
        let testGrants = [
            {
                id: "world-forgotten-children",
                name: "World Forgotten Children Foundation Grant",
                funder: "World Forgotten Children Foundation",
                amount: "Varies",
                deadline: "Rolling",
                deadlineDate: null,
                priority: 5,
                status: "ready",
                description: "Supports projects providing care and medical devices to improve lives of orphaned children and young adults with disabilities in developing countries. Focuses on children from newborn to 17 years living in orphanages, group homes, and similar facilities.",
                whyWeQualify: "Feed Tulum supports a local orphanage with under 20 children (expanding to 60), providing food, enrichment activities like English lessons and yoga, and building an onsite permaculture farm. Our programs directly align with improving quality of life for orphaned children.",
                instructions: [
                    "Download and complete the Project Proposal Form from their website",
                    "Email completed form to: help@world-forgotten-children.org",
                    "Attach: 501(c)(3) determination letter",
                    "Attach: Most recent Form 990",
                    "Include detailed budget for proposed project",
                    "Return here and mark as submitted"
                ],
                materials: {
                    emailSubject: "Project Proposal: Feed Tulum Orphanage Support Program",
                    emailBody: "Dear World Forgotten Children Foundation,\n\nWe are writing to submit a project proposal for your consideration. Feed Tulum (EIN: 86-2375227) is a U.S. 501(c)(3) nonprofit supporting orphaned children in Tulum, Mexico.\n\nWe currently partner with a local orphanage providing food security and enrichment programs for under 20 children, with plans to expand support to 60 children. Our programs include:\n\n- Regular food support ensuring consistent nutrition\n- English language lessons\n- Yoga and wellness activities  \n- On-site permaculture farm (recently launched) providing organic food\n- Post-graduation job placement assistance\n\nWe are seeking funding to expand our orphanage support programs, particularly our permaculture farm initiative which will provide sustainable, healthy food for the children.\n\nAttached you will find our 501(c)(3) determination letter, most recent Form 990, and detailed project budget.\n\nThank you for considering our proposal.\n\nBest regards,\nFeed Tulum Team\nfeedtulum@gmail.com"
                }
            },
            {
                id: "global-fund-children",
                name: "Global Fund for Children Partnership Grant",
                funder: "Global Fund for Children",
                amount: "$25,000 - $75,000",
                deadline: "Rolling",
                deadlineDate: null,
                priority: 4,
                status: "ready",
                description: "Partners with grassroots organizations worldwide working to improve lives of children and youth. Focuses on protecting children's rights, advancing youth leadership, and driving community-led change.",
                whyWeQualify: "As a community-led grassroots organization supporting vulnerable children through our orphanage programs and food bank, we align with their mission. We work directly in the community with local partners like Iglesia Camino Al Cielo.",
                instructions: [
                    "Visit globalfundforchildren.org",
                    "Review partnership requirements and eligibility",
                    "Complete their online partnership inquiry form",
                    "Prepare organizational overview and program description",
                    "Submit financial statements and 501(c)(3) documentation",
                    "Mark as submitted when application sent"
                ],
                materials: {
                    emailSubject: "Partnership Inquiry: Feed Tulum Community Programs",
                    emailBody: "Dear Global Fund for Children,\n\nFeed Tulum is a grassroots nonprofit (U.S. 501(c)(3), EIN: 86-2375227) creating pathways for people to give back to underserved neighbors in Tulum, Mexico.\n\nOur programs include:\n\n1. Local Orphanage Support: We partner with an orphanage supporting under 20 children (expanding to 60), providing:\n   - Consistent food and nutrition\n   - Educational enrichment (English lessons)\n   - Wellness activities (yoga)\n   - On-site permaculture farm for sustainable organic food\n   - Post-graduation job placement assistance\n\n2. Bi-weekly Food Bank: In collaboration with Iglesia Camino Al Cielo, we distribute free food kits to families in need.\n\n3. Tacos and Toys: Annual holiday event providing toys, food, and family experiences for local children.\n\nTo date, we've distributed tens of thousands of meals and countless clothing items and medical support to families and orphans in Tulum. We seek partnership to expand our impact and reach more vulnerable children in our community.\n\nWe would appreciate the opportunity to explore a partnership with Global Fund for Children.\n\nThank you for your consideration.\n\nBest regards,\nFeed Tulum Team\nfeedtulum@gmail.com"
                }
            },
            {
                id: "popeyes-food-love",
                name: "Popeyes Foundation Food Love Grants 2026",
                funder: "The Popeyes Foundation",
                amount: "$1,000 - $60,000",
                deadline: "2026 Cycle (Opening Soon)",
                deadlineDate: null,
                priority: 5,
                status: "ready",
                description: "Supports 501(c)(3) nonprofits serving food to those who need it. Focuses on food insecure, limited access, underserved, low-income individuals and families. Programs include onsite feeding, mobile kitchens, homebound delivery, out-of-school meals, and disaster food support.",
                whyWeQualify: "Our bi-weekly food bank directly serves food-insecure families in Tulum. We operate an ongoing feeding program providing free food kits to local families in need, and we support orphans with regular meals and nutrition.",
                instructions: [
                    "Visit popeyesfoundation.org/programs/food-love-grants",
                    "Complete the 2026 Food Love Grants Nonprofit Consideration Form",
                    "Provide organizational information and program details",
                    "Submit 501(c)(3) documentation",
                    "Wait for invitation to submit full application",
                    "Mark as submitted after consideration form sent"
                ],
                materials: {
                    emailSubject: "2026 Food Love Grant Consideration - Feed Tulum",
                    emailBody: "Program Overview for Consideration Form:\n\nOrganization: Feed Tulum (Tulum Food Support)\nEIN: 86-2375227\nStatus: 501(c)(3) nonprofit\n\nPrograms Serving Food to Those in Need:\n\n1. Bi-Weekly Food Bank\n- Partnership with Iglesia Camino Al Cielo\n- Free food kits distributed to local families\n- Serves food-insecure, low-income families in Tulum, Mexico\n- Tens of thousands of meals distributed to date\n\n2. Orphanage Feeding Program\n- Regular food support for under 20 orphaned children (expanding to 60)\n- On-site permaculture farm providing fresh organic produce\n- Ensuring consistent nutrition for vulnerable children\n\n3. Community Holiday Meals\n- Annual Tacos and Toys event\n- Provides meals and food to families during holidays\n\nOur programs address food insecurity in an underserved community where many families lack consistent access to nutritious food. We work with hard-working people who live in difficult conditions without regular access to basic amenities.\n\nWe request consideration for the 2026 Food Love Grants program to expand our food distribution capacity and reach more families in need.\n\nContact: feedtulum@gmail.com"
                }
            }
        ];

        // Check if already authenticated
        function checkAuth() {
            const isAuthenticated = sessionStorage.getItem('authenticated') === 'true';
            if (isAuthenticated) {
                showDashboard();
                renderGrants();
            } else {
                showLogin();
            }
        }

        function showLogin() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('dashboardScreen').classList.remove('show');
        }

        function showDashboard() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('dashboardScreen').classList.add('show');
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
        }

        function hideError() {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.classList.remove('show');
        }

        // Handle login form submission
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');

            // Disable button and show loading state
            loginBtn.disabled = true;
            loginBtn.textContent = 'Logging in...';
            hideError();

            try {
                const response = await fetch('/api/auth', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ password })
                });

                const data = await response.json();

                if (data.success) {
                    // Store authentication in sessionStorage
                    sessionStorage.setItem('authenticated', 'true');
                    showDashboard();
                } else {
                    showError(data.error || 'Invalid password');
                }
            } catch (error) {
                showError('Login failed. Please try again.');
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = 'Login';
            }
        });

        // Handle logout
        document.getElementById('logoutBtn').addEventListener('click', () => {
            sessionStorage.removeItem('authenticated');
            document.getElementById('password').value = '';
            showLogin();
        });

        // Calculate days until deadline
        function getDaysUntil(dateString) {
            if (!dateString) return null;
            const deadline = new Date(dateString);
            const today = new Date();
            const diffTime = deadline - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        // Generate priority stars
        function getPriorityStars(priority) {
            return 'â˜…'.repeat(priority) + 'â˜†'.repeat(5 - priority);
        }

        // Render all grants
        function renderGrants() {
            const container = document.getElementById('grantsList');

            // Load saved statuses
            const statuses = loadGrantStatuses();
            testGrants.forEach(grant => {
                if (statuses[grant.id]) {
                    grant.status = statuses[grant.id];
                }
            });

            // Sort by status (ready first) then by priority (highest first)
            const sortedGrants = [...testGrants].sort((a, b) => {
                if (a.status === b.status) {
                    return b.priority - a.priority;
                }
                return a.status === 'ready' ? -1 : 1;
            });

            container.innerHTML = sortedGrants.map(grant => {
                const daysUntil = getDaysUntil(grant.deadlineDate);
                const deadlineText = daysUntil !== null
                    ? `${grant.deadline} (${daysUntil} days left)`
                    : grant.deadline;

                return `
                    <div class="grant-card" data-grant-id="${grant.id}">
                        <div class="grant-header">
                            <div class="grant-title">
                                <h3>${grant.name}</h3>
                                <div class="grant-funder">${grant.funder}</div>
                            </div>
                            <div class="grant-meta">
                                <span class="grant-amount">${grant.amount}</span>
                                <span class="grant-deadline">${deadlineText}</span>
                                <span class="priority-stars" title="${grant.priority} out of 5">${getPriorityStars(grant.priority)}</span>
                                <span class="status-badge status-${grant.status}">${grant.status === 'ready' ? 'Ready' : 'Submitted'}</span>
                            </div>
                        </div>

                        <div class="grant-details">
                            <div class="detail-section">
                                <h4>Description</h4>
                                <p>${grant.description}</p>
                            </div>

                            <div class="detail-section">
                                <h4>Why We Qualify</h4>
                                <p>${grant.whyWeQualify}</p>
                            </div>

                            <div class="detail-section">
                                <h4>Application Materials</h4>
                                ${grant.materials.emailSubject ? `
                                    <div class="material-item">
                                        <div class="material-header">
                                            <span class="material-label">Email Subject:</span>
                                            <button class="btn-copy" onclick="copyToClipboard('subject-${grant.id}', this)">Copy</button>
                                        </div>
                                        <div class="material-content" id="subject-${grant.id}">${grant.materials.emailSubject}</div>
                                    </div>
                                ` : ''}
                                ${grant.materials.emailBody ? `
                                    <div class="material-item">
                                        <div class="material-header">
                                            <span class="material-label">Email Body:</span>
                                            <button class="btn-copy" onclick="copyToClipboard('body-${grant.id}', this)">Copy</button>
                                        </div>
                                        <div class="material-content" id="body-${grant.id}">${grant.materials.emailBody}</div>
                                    </div>
                                ` : ''}
                            </div>

                            <div class="detail-section">
                                <h4>Submission Instructions</h4>
                                <ul class="instructions-list">
                                    ${grant.instructions.map(step => `<li>${step}</li>`).join('')}
                                </ul>
                            </div>

                            <div class="action-buttons">
                                ${grant.status === 'ready'
                                    ? `<button class="btn-submit" onclick="markAsSubmitted('${grant.id}')">Mark as Submitted</button>`
                                    : `<button class="btn-submit" onclick="markAsNotSubmitted('${grant.id}')">Mark as Not Submitted</button>`
                                }
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Add click handlers to toggle expansion
            document.querySelectorAll('.grant-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    // Don't toggle if clicking on a button
                    if (e.target.tagName === 'BUTTON') return;
                    card.classList.toggle('expanded');
                });
            });
        }

        // Copy to clipboard
        function copyToClipboard(elementId, button) {
            const element = document.getElementById(elementId);
            const text = element.textContent;

            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                setTimeout(() => {
                    button.textContent = originalText;
                }, 2000);
            });
        }

        // Mark grant as submitted
        function markAsSubmitted(grantId) {
            const grant = testGrants.find(g => g.id === grantId);
            if (grant) {
                grant.status = 'submitted';

                // Save to localStorage
                const statuses = loadGrantStatuses();
                statuses[grantId] = 'submitted';
                saveGrantStatuses(statuses);

                renderGrants();
            }
        }

        // Mark grant as not submitted
        function markAsNotSubmitted(grantId) {
            const grant = testGrants.find(g => g.id === grantId);
            if (grant) {
                grant.status = 'ready';

                // Save to localStorage
                const statuses = loadGrantStatuses();
                statuses[grantId] = 'ready';
                saveGrantStatuses(statuses);

                renderGrants();
            }
        }

        // Check authentication on page load
        checkAuth();
    </script>
</body>
</html>
